{% extends 'ngux-tophat/base.html' %}
{% load humanize toolbox_tags %}

{% block content %}
<style type="text/css">
    table .data {text-align:right;}
    .small {font-size:12px;}
</style>

<div class="page-header">
    <h1>Complaint analysis</h1>
</div>

<div class="row-fluid">
    <div class="span12">
        <h2>All complaints</h2>
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th></th>
                    <th class="data">Total</th>
                    <th class="data">CSR Level 1</th>
                    <th class="data">2</th>
                    <th class="data">3</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Complaints older than a year not inspected or otherwise addressed as of 7/13/2014</td>
                    <td class="data">{{ open_over_one_year_count|intcomma }}</td>
                    <td class="data">{{ open_over_one_year_csr1|intcomma }}</td>    
                    <td class="data">{{ open_over_one_year_csr2|intcomma }}</td>    
                    <td class="data">{{ open_over_one_year_csr3|intcomma }}</td>    
                </tr>
                <tr>
                    <td>Complaints waited more than a year before inspection or other action</td>
                    <td class="data">{{ closed_over_one_year_count|intcomma }}</td>
                    <td class="data">{{ closed_over_one_year_csr1|intcomma }}</td>    
                    <td class="data">{{ closed_over_one_year_csr2|intcomma }}</td>    
                    <td class="data">{{ closed_over_one_year_csr3|intcomma }}</td>    
                </tr>
                <tr>
                    <td>Total complaints not inspected or otherwise addressed as of 7/13/2014</td>
                    <td class="data">{{ open_cases_count|intcomma }}</td>
                    <td class="data">{{ open_cases_csr1|intcomma }}</td>    
                    <td class="data">{{ open_cases_csr2|intcomma }}</td>    
                    <td class="data">{{ open_cases_csr3|intcomma }}</td>    
                </tr>
                <tr>
                    <td>Total complaints inspected or other action taken</td>
                    <td class="data">{{ closed_cases_count|intcomma }}</td>
                    <td class="data">{{ closed_cases_csr1|intcomma }}</td>    
                    <td class="data">{{ closed_cases_csr2|intcomma }}</td>    
                    <td class="data">{{ closed_cases_csr3|intcomma }}</td>    
                </tr>
                <tr>
                    <td>Total Complaints</td>
                    <td class="data">{{ total_count|intcomma }}</td>
                    <td class="data">{{ total_csr1|intcomma }}</td>    
                    <td class="data">{{ total_csr2|intcomma }}</td>    
                    <td class="data">{{ total_csr3|intcomma }}</td>    
                </tr>
                <tr>
                    <td>Avg. days wait until complaint is inspected or otherwise addressed (closed cases)</td>
                    <td class="data">{{ avg_wait_time|floatformat:2 }}</td>
                    <td class="data">{{ avg_wait_time_csr1|floatformat:2 }}</td>    
                    <td class="data">{{ avg_wait_time_csr2|floatformat:2 }}</td>    
                    <td class="data">{{ avg_wait_time_csr3|floatformat:2 }}</td>    
                </tr>
                <tr>
                    <td>Median days wait until complaint is inspected or otherwise addressed (KMF survival analysis)</td>
                    <td class="data">{{ median_wait_time_kmf }}</td>
                    <td class="data">{{ median_wait_time_csr1_kmf }}</td>    
                    <td class="data">{{ median_wait_time_csr2_kmf }}</td>    
                    <td class="data">{{ median_wait_time_csr3_kmf }}</td>    
                </tr>                
                <tr>
                    <td>Mean days wait until complaint is inspected or otherwise addressed (KMF survival analysis)</td>
                    <td class="data">{{ mean_wait_time_kmf|floatformat:2 }}</td>
                    <td class="data">{{ mean_wait_time_csr1_kmf|floatformat:2 }}</td>    
                    <td class="data">{{ mean_wait_time_csr2_kmf|floatformat:2 }}</td>    
                    <td class="data">{{ mean_wait_time_csr3_kmf|floatformat:2 }}</td>    
                </tr> 
            </tbody>
        </table>        

        <h2>By region</h2>
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Region</th>
                    <th class="data">> 1 yr to response</th>
                    <th class="data">total complaints</th>
                    <th class="data">Avg complaints / yr.</th>
                    <th class="data">Avg days to inspect</th>
                    <th class="data">CSR1 avg</th>
                    <th class="data">CSR2 avg</th>
                    <th class="data">CSR3 avg</th>
                    <th class="data">Median days</th>
                    <th class="data">CSR1 KMF median</th>
                    <th class="data">CSR2 KMF median</th>
                    <th class="data">CSR3 KMF median</th>
                </tr>                
            </thead>
            <tbody>
                {% for region, value in regions.items %}
                <tr>
                    <td>{{ region }}</td>
                    <td class="data">{{ value.gt_year|intcomma }}</td>
                    <td class="data">{{ value.total|intcomma }}</td>
                    <td class="data">{{ value.avg_complaints_per_year|floatformat:0|intcomma }}</td>
                    <td class="data">{{ value.avg_days_to_resolve|floatformat:2 }}</td>
                    <td class="data">{{ value.avg_days_csr1|floatformat:2 }}</td>
                    <td class="data">{{ value.avg_days_csr2|floatformat:2 }}</td>
                    <td class="data">{{ value.avg_days_csr3|floatformat:2 }}</td>
                    <td class="data">{{ value.median_wait_kmf }}</td>
                    <td class="data">{{ value.median_wait_kmf_csr1 }}</td>
                    <td class="data">{{ value.median_wait_kmf_csr2 }}</td>
                    <td class="data">{{ value.median_wait_kmf_csr3 }}</td>            
                </tr>
                {% endfor%}
            </tbody>
        </table>    


        <h3>Wait times</h3>
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Region</th>
                    <th class="data">% > 30 days</th>
                    <th class="data">% > 90 days</th>
                    <th class="data">% > 180 days</th>
                    <th class="data">% > 1 yr</th>
                </tr>                
            </thead>
            <tbody>
                {% for region, value in regions.items %}
                <tr>
                    <td>{{ region }}</td>
                    <td class="data">{{ value.per_gt_30_days|floatformat:2 }}</td>
                    <td class="data">{{ value.per_gt_90_days|floatformat:2 }}</td>
                    <td class="data">{{ value.per_gt_180_days|floatformat:2 }}</td>
                    <td class="data">{{ value.per_gt_year|floatformat:2 }}</td>
                </tr>
                {% endfor%}
            </tbody>            
        </table>    

        <h4>Wait times by year</h4>
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Area</th>
                    <th class="data">Median wait</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Citywide 2011</td>
                    <td class="data">{{ complaints_2011_median_wait_time }}</td>
                </tr>
                <tr>
                    <td>Eastside 2011</td>
                    <td class="data">{{ eastside_complaints_2011_median_wait_time }}</td>
                </tr>
                <tr>
                    <td>Citywide 2012</td>
                    <td class="data">{{ complaints_2012_median_wait_time }}</td>
                </tr>
                <tr>
                    <td>Eastside 2012</td>
                    <td class="data">{{ eastside_complaints_2012_median_wait_time }}</td>
                </tr>
                <tr>
                    <td>Citywide 2013</td>
                    <td class="data">{{ complaints_2013_median_wait_time }}</td>
                </tr>
                <tr>
                    <td>Eastside 2013</td>
                    <td class="data">{{ eastside_complaints_2013_median_wait_time }}</td>
                </tr>
                <tr>
                    <td>Citywide 2013 CSR 1 Complaints</td>
                    <td class="data">{{ csr_1_complaints_2013_median_wait }}</td>
                </tr>
                <tr>
                    <td>Citywide 2014</td>
                    <td class="data">{{ complaints_2014_median_wait_time }}</td>
                </tr>
                <tr>
                    <td>Eastside 2014</td>
                    <td class="data">{{ eastside_complaints_2014_median_wait_time }}</td>
                </tr>
            </tbody>            
        </table>                

        <h3>Kaplan-Meier mean wait</h3>
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Region</th>
                    <th class="data">KMF avg days</th>
                    <th class="data">CSR1 KMF avg</th>
                    <th class="data">CSR2 KMF avg</th>
                    <th class="data">CSR3 KMF avg</th>
                </tr>                
            </thead>
            <tbody>
                {% for region, value in regions.items %}
                <tr>
                    <td>{{ region }}</td>
                    <td class="data">{{ value.mean_wait_kmf|floatformat:2 }}</td>
                    <td class="data">{{ value.mean_wait_kmf_csr1|floatformat:2 }}</td>
                    <td class="data">{{ value.mean_wait_kmf_csr2|floatformat:2 }}</td>
                    <td class="data">{{ value.mean_wait_kmf_csr3|floatformat:2 }}</td>       
                </tr>
                {% endfor%}
            </tbody>            
        </table>
    
        <h3>Overall complaint numbers</h3>
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Region</th>
                    <th class="data">CSR 1</th>
                    <th class="data">CSR 2</th>
                    <th class="data">CSR 3</th>
                    <th class="data">Total</th>
                </tr>                
            </thead>
            <tbody>
                {% for region, value in regions.items %}
                <tr>
                    <td>{{ region }}</td>
                    <td class="data">{{ value.csr1|intcomma }} <span class="small">({{ value.csr1_percent|floatformat:2 }}%)</span></td>
                    <td class="data">{{ value.csr2|intcomma }} <span class="small">({{ value.csr2_percent|floatformat:2 }}%)</span></td>
                    <td class="data">{{ value.csr3|intcomma }} <span class="small">({{ value.csr3_percent|floatformat:2 }}%)</span></td>       
                    <td class="data">{{ value.total|intcomma }}</td>       
                </tr>
                {% endfor%}
            </tbody>            
        </table>
    
    </div>
</div>

{% endblock %}